---
layout: page
title: Search
permalink: /search/
---

<h1>Search</h1>

<input type="search" id="search-input" placeholder="Search...">
<ul id="search-results"></ul>

<script>
// Build index from pages
var pages = [
  {% for page in site.pages %}
  {
    "title": {{ page.title | jsonify }},
    "url": {{ page.url | relative_url | jsonify }},
    "content": {{ page.content | strip_html | strip_newlines | jsonify }}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];

// Build index from posts
var posts = [
  {% for post in site.posts %}
  {
    "title": {{ post.title | jsonify }},
    "url": {{ post.url | relative_url | jsonify }},
    "content": {{ post.content | strip_html | strip_newlines | jsonify }}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];

var store = pages.concat(posts);

(function () {
  function getQuery() {
    var params = new URLSearchParams(window.location.search);
    return params.get('q') || '';
  }

  function search(q) {
    q = q.toLowerCase();
    if (!q) return [];
    return store.filter(function (item) {
      return item.title.toLowerCase().indexOf(q) !== -1 ||
             item.content.toLowerCase().indexOf(q) !== -1;
    });
  }

  function render(results, q) {
    var list = document.getElementById('search-results');
    list.innerHTML = '';
    if (!q) return;
    if (!results.length) {
      list.innerHTML = '<li>No results found.</li>';
      return;
    }
    results.forEach(function (item) {
      var li = document.createElement('li');
      li.innerHTML = '<a href="' + item.url + '">' + item.title + '</a>';
      list.appendChild(li);
    });
  }

  var box = document.getElementById('search-input');
  var initialQuery = getQuery();
  box.value = initialQuery;
  render(search(initialQuery), initialQuery);

  box.addEventListener('input', function (e) {
    var q = e.target.value;
    var newUrl = window.location.pathname + (q ? '?q=' + encodeURIComponent(q) : '');
    if (history.replaceState) {
      history.replaceState(null, '', newUrl);
    }
    render(search(q), q);
  });
})();
</script>
