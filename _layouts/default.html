<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang }}">

{% include head.html %}

<header class="hover smooth">
  <div class="header-top">
    {% unless site.show_minimal and site.navigation and site.external %}
      <h1 {% if site.navigation and site.external %}class="full"{% endif %}>
        <a href="{{ "/" | relative_url }}">{{ site.title | escape }}</a>
      </h1>
    {% endunless %}

    <!-- Search bar on same line as title -->
    <form class="site-search" onsubmit="return false;">
      <input type="search" id="global-search-input" placeholder="Search..." />
    </form>
  </div>

  <div class="header-menus">
    {% include menu.html menu=site.navigation %}
    {% include menu.html menu=site.external %}
  </div>

  <img
    src="{{ '/assets/header_banner.png' | relative_url }}"
    alt="Quantum simulation banner"
    class="header-banner"
  >
</header>

<ul id="search-results" class="search-results"></ul>

{{ content }}

{%- if site.footer -%}
<footer class="hover">
  <div>{{ site.description }}</div>
  {% include menu.html menu=site.footer %}
</footer>
{%- endif -%}

<script>
// Build an index of all pages and posts at build time
var searchIndex = [
  {% assign docs = site.pages | concat: site.posts %}
  {% for doc in docs %}
  {
    "title": {{ doc.title | default: doc.url | jsonify }},
    "url": {{ doc.url | relative_url | jsonify }},
    "content": {{ doc.content | strip_html | strip_newlines | jsonify }}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];

(function () {
  var input = document.getElementById('global-search-input');
  var resultsList = document.getElementById('search-results');
  if (!input || !resultsList) return;

  function search(q) {
    q = q.trim().toLowerCase();
    if (!q) return [];
    return searchIndex.filter(function (item) {
      var title = (item.title || '').toLowerCase();
      var content = (item.content || '').toLowerCase();
      return title.indexOf(q) !== -1 || content.indexOf(q) !== -1;
    }).slice(0, 20); // up to 20 results
  }

  function render(results) {
    resultsList.innerHTML = '';
    if (!results.length) return;

    results.forEach(function (item) {
      var li = document.createElement('li');
      var title = item.title || item.url;
      li.innerHTML = '<a href="' + item.url + '">' + title + '</a>';
      resultsList.appendChild(li);
    });
  }

  input.addEventListener('input', function (e) {
    var q = e.target.value;
    if (!q.trim()) {
      resultsList.innerHTML = '';
      return;
    }
    render(search(q));
  });
})();
</script>
</html>
