<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang }}">

{% include head.html %}

<header class="hover smooth">
  <div class="header-top">
    {% unless site.show_minimal and site.navigation and site.external %}
      <h1 {% if site.navigation and site.external %}class="full"{% endif %}>
        <a href="{{ "/" | relative_url }}">{{ site.title | escape }}</a>
      </h1>
    {% endunless %}

    <form class="site-search" onsubmit="return false;">
      <input type="search" id="global-search-input" placeholder="Search..." />
    </form>
  </div>

  <div class="header-menus">
    <div class="header-nav">
      {% include menu.html menu=site.navigation %}
    </div>
    <div class="header-icons">
      {% include menu.html menu=site.external %}
    </div>
  </div>

  <img
    src="{{ '/assets/header_banner.png' | relative_url }}"
    alt="Quantum simulation banner"
    class="header-banner"
  >
</header>

<ul id="search-results" class="search-results"></ul>

{{ content }}

<footer class="hover">
  {% if site.description %}
    <div>{{ site.description }}</div>
  {% endif %}

  <div class="footer-credit">
    Forked from
    <a href="https://github.com/niklasbuschmann/contrast">contrast</a>,
    powered by
    <a href="https://jekyllrb.com/">Jekyll</a>.
  </div>

  {% if site.footer %}
    {% include menu.html menu=site.footer %}
  {% endif %}
</footer>

<script>
var searchIndex = [
  {% assign searchable_pages = site.pages | where_exp: "page", "page.search == true" %}
  {% assign docs = searchable_pages %}
  {% for doc in docs %}
  {
    "title": {{ doc.search_title | default: doc.title | default: doc.url | jsonify }},
    "url": {{ doc.url | relative_url | jsonify }},
    "content": {{ doc.content | strip_html | strip_newlines | jsonify }}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];

(function () {
  var input = document.getElementById('global-search-input');
  var resultsList = document.getElementById('search-results');
  if (!input || !resultsList) return;

  function search(q) {
    q = q.trim().toLowerCase();
    if (!q) return [];
    return searchIndex.filter(function (item) {
      var title = (item.title || '').toLowerCase();
      var content = (item.content || '').toLowerCase();
      return title.indexOf(q) !== -1 || content.indexOf(q) !== -1;
    }).slice(0, 20);
  }

  function render(results, q) {
    q = q || '';
    resultsList.innerHTML = '';

    if (!q.trim()) {
      resultsList.style.display = 'none';
      return;
    }

    resultsList.style.display = 'block';

    if (!results.length) {
      resultsList.innerHTML = '<li>No results found.</li>';
      return;
    }

    results.forEach(function (item) {
      var li = document.createElement('li');
      var title = item.title || item.url;
      li.innerHTML = '<a href="' + item.url + '">' + title + '</a>';
      resultsList.appendChild(li);
    });
  }

  // ðŸ”¹ Hide results on initial page load
  render([], '');

  input.addEventListener('input', function (e) {
    var q = e.target.value;
    render(search(q), q);
  });
})();
</script>
</html>
